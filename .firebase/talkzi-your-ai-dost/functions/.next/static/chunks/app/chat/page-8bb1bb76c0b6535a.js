(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8457],{8198:(e,t,s)=>{Promise.resolve().then(s.bind(s,8739))},8539:(e,t,s)=>{"use strict";s.d(t,{T:()=>n});var r=s(5155),a=s(2115),l=s(9434);let n=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("textarea",{className:(0,l.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:t,...a})});n.displayName="Textarea"},8739:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>eE});var r=s(5155),a=s(2115),l=s(9434),n=s(1721),o=s(3503),i=s(1949),c=s(620),d=s(6766),m=s(8547);let u=a.memo(e=>{var t;let{message:s,onFeedback:a,onSpeak:u,isSpeaking:f}=e,h="user"===s.sender,x="ai"===s.sender,p="system"===s.sender,g=s.isCrisis,y=h?n.A:o.A,b=h?"bg-primary/20":"bg-input",j=h?"text-primary":"text-foreground",v=h?"bg-primary text-primary-foreground":"bg-input text-foreground",w={};x?s.aiBubbleColor&&s.aiTextColor&&(w={backgroundColor:s.aiBubbleColor,color:s.aiTextColor},b="bg-muted",j=s.aiTextColor):g&&(v="bg-destructive/80 text-destructive-foreground",b="bg-destructive text-destructive-foreground");let N=h?"You":g?"System Alert":(null===(t=m.De.find(e=>e.imageUrl===s.personaImage))||void 0===t?void 0:t.label)||"AI";return p&&!g?(0,r.jsx)("div",{className:"flex flex-col w-full my-2 items-center",children:(0,r.jsx)("div",{className:(0,l.cn)("p-3 shadow-sm rounded-xl max-w-[80%] sm:max-w-[70%]","bg-muted text-muted-foreground text-sm"),children:(0,r.jsx)("p",{className:"whitespace-pre-wrap break-words",children:s.text})})}):g?(0,r.jsxs)("div",{className:(0,l.cn)("flex flex-col w-full my-2 items-start"),children:[(0,r.jsx)("p",{className:"text-muted-foreground text-[13px] font-normal leading-normal ml-12 mb-0.5",children:N}),(0,r.jsxs)("div",{className:(0,l.cn)("flex items-end gap-2 max-w-[80%] sm:max-w-[70%]","flex-row"),children:[(0,r.jsx)("div",{className:(0,l.cn)("flex items-center justify-center h-10 w-10 rounded-full shrink-0 self-start",b),children:(0,r.jsx)(i.A,{className:"h-5 w-5 text-destructive-foreground"})}),(0,r.jsx)("div",{className:(0,l.cn)("p-3 shadow-md min-w-[60px] rounded-xl",v,"border border-destructive"),style:w,children:(0,r.jsx)("p",{className:"text-sm whitespace-pre-wrap break-words",children:s.text})})]})]}):(0,r.jsxs)("div",{className:(0,l.cn)("flex flex-col w-full my-2",h?"items-end justify-end":"items-start justify-start"),children:[(0,r.jsx)("p",{className:(0,l.cn)("text-muted-foreground text-[13px] font-normal leading-normal max-w-[360px] mb-0.5",h?"mr-12 text-right":"ml-12 text-left"),children:N}),(0,r.jsxs)("div",{className:(0,l.cn)("flex items-end gap-2 max-w-[80%] sm:max-w-[70%]",h?"flex-row-reverse":"flex-row"),children:[(0,r.jsx)("div",{className:(0,l.cn)("flex items-center justify-center h-10 w-10 rounded-full shrink-0 self-start overflow-hidden",b),children:x&&s.personaImage?(0,r.jsx)(d.default,{src:s.personaImage,alt:"AI Persona",width:40,height:40,className:"object-cover"}):(0,r.jsx)(y,{className:(0,l.cn)("h-5 w-5",j)})}),(0,r.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,r.jsx)("div",{className:(0,l.cn)("px-4 py-3 shadow-md min-w-[60px] rounded-xl",x?"":v),style:x?w:{},children:(0,r.jsx)("p",{className:"text-base font-normal leading-normal whitespace-pre-wrap break-words",children:s.text})}),x&&u&&(0,r.jsxs)("button",{onClick:u,disabled:f,className:(0,l.cn)("self-start px-2 py-1 text-xs rounded-full transition-colors","bg-muted hover:bg-muted/80 text-muted-foreground","disabled:opacity-50 disabled:cursor-not-allowed","flex items-center gap-1"),children:[(0,r.jsx)(c.A,{size:14}),f?"Speaking...":"Speak"]})]})]})]})});u.displayName="MessageBubble";var f=s(285),h=s(8539),x=s(6273),p=s(172),g=s(7687),y=s(5695);function b(e){let{onSendMessage:t,isLoading:s,sendButtonAccentColor:n,onFocus:o,disabled:i}=e,[c,d]=(0,a.useState)(""),[m,u]=(0,a.useState)(!1),b=(0,a.useRef)(null),j=(0,a.useRef)(null),v=(0,y.useRouter)(),w=e=>{null==e||e.preventDefault(),!c.trim()||s||m||i||(t(c.trim()),d(""),setTimeout(()=>{var e;return null===(e=b.current)||void 0===e?void 0:e.focus()},50))},N=c.trim()&&!m&&!i;return(0,r.jsx)("form",{ref:j,onSubmit:w,className:"sticky bottom-0 left-0 right-0 z-10 p-3 md:p-4 border-t bg-background/95 backdrop-blur-sm",children:(0,r.jsxs)("div",{className:"flex items-end w-full bg-input rounded-xl min-h-[48px] px-3 py-2 gap-2 transition-all duration-200 focus-within:ring-1 focus-within:ring-primary/50",children:[(0,r.jsx)(f.$,{type:"button",size:"sm",variant:"ghost",onClick:()=>{v.push("/audiovisualizer")},disabled:s||i,className:(0,l.cn)("h-9 w-9 p-0 rounded-lg"),"aria-label":"Start voice input",children:(0,r.jsx)(x.A,{className:"h-4 w-4"})}),(0,r.jsx)(h.T,{ref:b,value:c,onChange:e=>d(e.target.value),onFocus:()=>{o&&o(),window.innerWidth<768&&setTimeout(()=>{var e;null===(e=j.current)||void 0===e||e.scrollIntoView({behavior:"smooth",block:"end"})},300)},onCompositionStart:()=>u(!0),onCompositionEnd:()=>u(!1),placeholder:window.innerWidth>=768?"Type your message. Press Enter for new line, Ctrl+Enter to send.":"Type a message...",className:(0,l.cn)("flex-grow resize-none bg-transparent border-none shadow-none focus-visible:ring-0 focus-visible:ring-offset-0 min-h-[28px] max-h-[120px] text-base py-1.5 px-0 text-foreground placeholder:text-muted-foreground self-center overflow-y-auto","scrollbar-thin"),rows:1,disabled:s||i,onKeyDown:e=>{!m&&("Enter"===e.key?(e.ctrlKey||e.metaKey)&&(e.preventDefault(),w()):"Escape"===e.key&&c&&(e.preventDefault(),d("")))},style:{lineHeight:"1.6"}}),(0,r.jsx)(f.$,{type:"submit",size:"sm",disabled:!N||s||i,className:(0,l.cn)("text-primary-foreground rounded-lg h-9 min-w-9 px-3 text-sm font-medium shrink-0 transition-all duration-150 ease-in-out",!n&&"bg-primary hover:bg-primary/90",N&&!s?"opacity-100 scale-100":"opacity-60 scale-95 cursor-not-allowed","shadow-sm hover:shadow-md focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-1"),style:n?{backgroundColor:n,color:"hsl(var(--primary-foreground))"}:{},"aria-label":"Send message",children:s?(0,r.jsx)(p.A,{className:"h-4 w-4 animate-spin"}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(g.A,{className:"h-4 w-4 @[480px]:mr-1.5"}),(0,r.jsx)("span",{className:"hidden @[480px]:inline text-xs",children:"Send"})]})})]})})}var j=s(6655);function v(e){let{personaImageUrl:t,personaName:s,personaTheme:a}=e,n=s||"Talkzii",i=a?{backgroundColor:a.primaryColor,color:a.bubbleTextColor}:{},c=a?"bg-muted":"bg-input text-foreground",m=a?a.bubbleTextColor:"text-foreground";return(0,r.jsxs)("div",{className:(0,l.cn)("flex flex-col w-full my-2 items-start justify-start",null==a?void 0:a.fontClassName),children:[(0,r.jsx)("p",{className:"text-muted-foreground text-[13px] font-normal leading-normal ml-12 mb-0.5",children:n}),(0,r.jsxs)("div",{className:(0,l.cn)("flex items-end gap-2 max-w-[80%] sm:max-w-[70%]","flex-row"),children:[(0,r.jsx)("div",{className:(0,l.cn)("flex items-center justify-center h-10 w-10 rounded-full shrink-0 self-start overflow-hidden",c),children:t?(0,r.jsx)(d.default,{src:t,alt:"".concat(n," Typing"),width:40,height:40,className:"object-cover"}):(0,r.jsx)(o.A,{className:(0,l.cn)("h-5 w-5",m)})}),(0,r.jsxs)("div",{className:(0,l.cn)("px-4 py-3 shadow-md min-w-[60px] rounded-xl flex items-center space-x-2",!a&&"bg-input text-foreground"),style:i,children:[(0,r.jsx)(j.A,{className:"h-4 w-4 text-muted-foreground animate-pulse",style:a?{color:a.bubbleTextColor}:{}}),(0,r.jsxs)("p",{className:"text-base font-normal leading-normal whitespace-pre-wrap break-words",children:[n," is thinking"]})]})]})]})}var w=s(7649);let N=w.bL;w.l9;let k=w.ZL,C=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(w.hJ,{className:(0,l.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...a,ref:t})});C.displayName=w.hJ.displayName;let S=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsxs)(k,{children:[(0,r.jsx)(C,{}),(0,r.jsx)(w.UC,{ref:t,className:(0,l.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...a})]})});S.displayName=w.UC.displayName;let _=e=>{let{className:t,...s}=e;return(0,r.jsx)("div",{className:(0,l.cn)("flex flex-col space-y-2 text-center sm:text-left",t),...s})};_.displayName="AlertDialogHeader";let E=e=>{let{className:t,...s}=e;return(0,r.jsx)("div",{className:(0,l.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...s})};E.displayName="AlertDialogFooter";let A=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(w.hE,{ref:t,className:(0,l.cn)("text-lg font-semibold",s),...a})});A.displayName=w.hE.displayName;let z=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(w.VY,{ref:t,className:(0,l.cn)("text-sm text-muted-foreground",s),...a})});z.displayName=w.VY.displayName;let I=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(w.rc,{ref:t,className:(0,l.cn)((0,f.r)(),s),...a})});I.displayName=w.rc.displayName;let P=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(w.ZD,{ref:t,className:(0,l.cn)((0,f.r)({variant:"outline"}),"mt-2 sm:mt-0",s),...a})});P.displayName=w.ZD.displayName;var T=s(4913);function R(e){let{isOpen:t,onClose:s,onSubscribe:a,accentColor:l}=e,n=l||"hsl(var(--primary))",o=l||"hsl(var(--primary))",i=l||"hsl(var(--primary))";return(0,r.jsx)(N,{open:t,onOpenChange:s,children:(0,r.jsxs)(S,{className:"rounded-xl",children:[(0,r.jsxs)(_,{children:[(0,r.jsx)("div",{className:"flex justify-center mb-4",children:(0,r.jsx)(T.A,{className:"h-12 w-12",style:{color:o}})}),(0,r.jsx)(A,{className:"text-2xl font-bold text-center",children:"Unlock Unlimited Chats!"}),(0,r.jsx)(z,{className:"text-center text-muted-foreground pt-2",children:"You've used all your free messages. Upgrade to Talkzii Premium for unlimited conversations, priority support, and more!"})]}),(0,r.jsxs)("div",{className:"py-4 text-center",children:[(0,r.jsxs)("p",{className:"text-3xl font-extrabold",style:{color:i},children:["â‚¹30 ",(0,r.jsx)("span",{className:"text-base font-normal text-muted-foreground",children:"/ month"})]}),(0,r.jsxs)("ul",{className:"mt-4 text-left space-y-2 text-sm text-muted-foreground list-disc list-inside px-4",children:[(0,r.jsx)("li",{children:"Unlimited messages"}),(0,r.jsx)("li",{children:"Access to all features"}),(0,r.jsx)("li",{children:"Priority AI responses"}),(0,r.jsx)("li",{children:"Support Talkzii's development"})]})]}),(0,r.jsxs)(E,{className:"flex-col sm:flex-row gap-2",children:[(0,r.jsx)(P,{asChild:!0,children:(0,r.jsx)(f.$,{variant:"outline",onClick:s,className:"w-full sm:w-auto",children:"Maybe Later"})}),(0,r.jsx)(I,{asChild:!0,children:(0,r.jsx)(f.$,{onClick:a,className:"w-full sm:w-auto text-primary-foreground",style:{backgroundColor:n},children:"Subscribe Now"})})]})]})})}var L=s(4477);let M=(0,L.createServerReference)("405ce3d10362a75a77e421e8e824af5f987195ee8c",L.callServer,void 0,L.findSourceMapURL,"detectCrisis"),H=(0,L.createServerReference)("7fdd3569d9a8801700ec5bcfc65f574987d781865a",L.callServer,void 0,L.findSourceMapURL,"hinglishAICompanion");var U=s(7481),O=s(9051);let D=a.forwardRef((e,t)=>{let{className:s,children:a,...n}=e;return(0,r.jsxs)(O.bL,{ref:t,className:(0,l.cn)("relative overflow-hidden",s),...n,children:[(0,r.jsx)(O.LM,{className:"h-full w-full rounded-[inherit]",children:a}),(0,r.jsx)($,{}),(0,r.jsx)(O.OK,{})]})});D.displayName=O.bL.displayName;let $=a.forwardRef((e,t)=>{let{className:s,orientation:a="vertical",...n}=e;return(0,r.jsx)(O.VM,{ref:t,orientation:a,className:(0,l.cn)("flex touch-none select-none transition-colors","vertical"===a&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===a&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",s),...n,children:(0,r.jsx)(O.lr,{className:"relative flex-1 rounded-full bg-border"})})});$.displayName=O.VM.displayName;var F=s(5554),J=s(3125),K=s(7223),V=s(9556),Z=s(283),W=s(2643);let B=e=>e?"talkzii_chat_history_".concat(e):"talkzii_chat_history_guest",Y=e=>e?"talkzii_chat_memory_".concat(e):"talkzii_chat_memory_guest",G=e=>e?"talkzii_ai_friend_type_".concat(e):"talkzii_ai_friend_type_guest",q=e=>e?"talkzii_memory_warning_shown_".concat(e):"talkzii_memory_warning_shown_guest",X=e=>{let t={},s={};for(let s of[/(?:my name is|i am|i'm|call me|name's)\s+([a-zA-Z\s]+)(?:$|\s|,|\.|!|\?)/i,/(?:i am called|known as|people call me)\s+([a-zA-Z\s]+)(?:$|\s|,|\.|!|\?)/i]){let r=e.match(s);if(r&&r[1]){t.name=r[1].trim().split(" ")[0],t.name=t.name.charAt(0).toUpperCase()+t.name.slice(1).toLowerCase();break}}let r=[];for(let t of[/i (?:like|love|enjoy|prefer)\s+([^.!?]+)/gi,/my (?:hobby|hobbies|interest|interests)\s+(?:is|are)\s+([^.!?]+)/gi])[...e.matchAll(t)].forEach(e=>{e[1]&&r.push(e[1].trim().toLowerCase())});for(let[a,l]of(r.length>0&&(t.interests=[...new Set(r)]),Object.entries({age:/(?:i am|i'm)\s+(\d+)\s+years?\s+old/i,location:/(?:i (?:live|am) (?:in|from|at))\s+([a-zA-Z\s,]+)/i,job:/(?:i (?:work|am)\s+(?:as|a)\s+)([a-zA-Z\s]+)/i,profession:/(?:my job is|i am a|i work as)\s+([a-zA-Z\s]+)/i}))){let t=e.match(l);t&&t[1]&&(s[a]=t[1].trim())}return Object.keys(s).length>0&&(t.personalInfo=s),t},Q=(e,t)=>{var s;let r=[];if(e.userProfile.name&&r.push("User's name is ".concat(e.userProfile.name,".")),e.userProfile.personalInfo&&Object.keys(e.userProfile.personalInfo).length>0){let t=Object.entries(e.userProfile.personalInfo).map(e=>{let[t,s]=e;return"".concat(t," is ").concat(s)}).join(", ");t&&r.push("Other known info about user: ".concat(t,"."))}if((null===(s=e.userProfile.interests)||void 0===s?void 0:s.length)&&r.push("User is interested in ".concat(e.userProfile.interests.join(", "),".")),e.chatHistory.length>0&&(r.push("\nRecent conversation highlights (last few exchanges):"),e.chatHistory.slice(-5).forEach(e=>{r.push('User: "'.concat(e.userMessage,'" | AI: "').concat(e.aiResponse,'"'))})),0===r.length)return t;let a="CONTEXT FOR AI:\n";return a+=r.join("\n"),a+='\n\nCURRENT USER MESSAGE (respond to this naturally, considering the context above): "'.concat(t,'"')};async function ee(e){try{let{error:t}=await W.N.from("message_feedback").insert(e);t&&console.error("Error saving message feedback to Supabase:",t)}catch(e){console.error("Exception while saving message feedback:",e)}}function et(){var e;let{user:t,profile:s,isLoading:n}=(0,Z.A)(),[o,i]=(0,a.useState)([]),[c,d]=(0,a.useState)({userProfile:{},conversationContext:{recentTopics:[],lastMentionedEntities:[],conversationTone:"friendly"},chatHistory:[]}),[h,x]=(0,a.useState)(!1),[p,g]=(0,a.useState)(!1),[y,j]=(0,a.useState)(!1),[w,N]=(0,a.useState)(!1),{toast:k}=(0,U.dj)(),C=(0,a.useRef)(null),S=(0,a.useRef)(null),_=(0,a.useRef)(null),[E,A]=(0,a.useState)("default"),[z,I]=(0,a.useState)((0,m.N_)()),[P,T]=(0,a.useState)((0,m.E_)("default")),[L,O]=(0,a.useState)(!1),[$,W]=(0,a.useState)(!1),[et,es]=(0,a.useState)(!0),[er,ea]=(0,a.useState)(0),{chatCount:el,incrementChatCount:en,isLoading:eo}=function(e){let[t,s]=(0,a.useState)(!0),[r,l]=(0,a.useState)(0),n=(0,a.useMemo)(()=>e?"".concat("talkzii_chat_count_user","_").concat(e):"talkzii_chat_count_guest",[e]);(0,a.useEffect)(()=>{s(!0);try{let e=localStorage.getItem(n);e?l(parseInt(e,10)):l(0)}catch(e){console.error("Error reading chat count from localStorage for key:",n,e),l(0)}s(!1)},[n]);let o=(0,a.useCallback)(e=>{try{localStorage.setItem(n,e.toString())}catch(e){console.error("Error setting chat count in localStorage for key:",n,e)}},[n]);return{chatCount:r,incrementChatCount:(0,a.useCallback)(()=>{l(e=>{let t=e+1;return o(t),t})},[o]),resetChatCount:(0,a.useCallback)(()=>{l(0),o(0)},[o]),isLoading:t}}(null==t?void 0:t.id),[ei,ec]=(0,a.useState)({chatHistory:B(null==t?void 0:t.id),chatMemory:Y(null==t?void 0:t.id),aiFriendType:G(null==t?void 0:t.id),memoryWarning:q(null==t?void 0:t.id)}),[ed,em]=(0,a.useState)(!1),[eu,ef]=(0,a.useState)(!1),[eh,ex]=(0,a.useState)(""),ep=(0,a.useCallback)((e,t,s)=>{d(r=>{var a;let l=JSON.parse(JSON.stringify(r)),n=X(e),o=!1;if(n.name&&l.userProfile.name!==n.name&&(l.userProfile.name=n.name,o=!0),null===(a=n.interests)||void 0===a?void 0:a.length){let e=new Set(l.userProfile.interests||[]).size,t=[...new Set([...l.userProfile.interests||[],...n.interests])];t.length>e&&(o=!0),l.userProfile.interests=t.slice(-10)}if(n.personalInfo&&Object.keys(n.personalInfo).length>0)for(let e in l.userProfile.personalInfo||(l.userProfile.personalInfo={}),n.personalInfo)l.userProfile.personalInfo[e]!==n.personalInfo[e]&&(l.userProfile.personalInfo[e]=n.personalInfo[e],o=!0);o&&(j(!0),setTimeout(()=>j(!1),3e3));let i={messageId:s,userMessage:e,aiResponse:t,timestamp:Date.now()};return l.chatHistory=[...l.chatHistory,i].slice(-20),l})},[]),eg=(0,a.useCallback)(()=>{d({userProfile:{},conversationContext:{recentTopics:[],lastMentionedEntities:[],conversationTone:"friendly"},chatHistory:[]});try{localStorage.removeItem(ei.chatMemory),localStorage.removeItem(ei.memoryWarning),N(!1),k({title:"Memory Cleared",description:"Chat memory has been reset. I won't remember our previous conversations or personal details."})}catch(e){console.error("Error clearing chat memory from localStorage:",e),k({title:"Error",description:"Could not clear chat memory.",variant:"destructive"})}},[ei.chatMemory,ei.memoryWarning,k]),ey=(0,a.useCallback)(function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];S.current?S.current.scrollTo({top:S.current.scrollHeight,behavior:e?"smooth":"auto"}):_.current&&_.current.scrollIntoView({behavior:e?"smooth":"auto",block:"end"})},[]),eb=(0,a.useCallback)(()=>{if(!S.current)return;let{scrollTop:e,scrollHeight:t,clientHeight:s}=S.current,r=t-e-s<150;es(r),W(!r&&o.length>3)},[o.length]);(0,a.useEffect)(()=>{let e=S.current;if(e&&L)return e.addEventListener("scroll",eb,{passive:!0}),eb(),()=>e.removeEventListener("scroll",eb)},[eb,L]),(0,a.useEffect)(()=>{let e=o.length>er;if(et||e){let t=setTimeout(()=>ey(!0),e?50:100);return e&&ea(o.length),()=>clearTimeout(t)}e||ea(o.length)},[o,et,er,ey]),(0,a.useEffect)(()=>{h&&et&&ey(!0)},[h,et,ey]),(0,a.useEffect)(()=>{let e=e=>{"Escape"===e.key&&p&&g(!1),(e.ctrlKey||e.metaKey)&&"end"===e.key.toLowerCase()&&(e.preventDefault(),ey(!0)),(e.ctrlKey||e.metaKey)&&("delete"===e.key.toLowerCase()||"Backspace"===e.key)&&e.shiftKey&&(e.preventDefault(),eg())};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[p,ey,eg]),(0,a.useEffect)(()=>{O(!0);let e=C.current;if(e){let t=e.querySelector("[data-radix-scroll-area-viewport]");t&&(S.current=t)}},[]),(0,a.useEffect)(()=>{ec({chatHistory:B(null==t?void 0:t.id),chatMemory:Y(null==t?void 0:t.id),aiFriendType:G(null==t?void 0:t.id),memoryWarning:q(null==t?void 0:t.id)})},[t]),(0,a.useEffect)(()=>{if(n||!L)return;try{let e=localStorage.getItem(ei.chatHistory),t=e?JSON.parse(e):[];i(t),ea(t.length);let s=localStorage.getItem(ei.chatMemory);s?d(JSON.parse(s)):d({userProfile:{},conversationContext:{recentTopics:[],lastMentionedEntities:[],conversationTone:"friendly"},chatHistory:[]});let r="true"===localStorage.getItem(ei.memoryWarning);N(r),t.length>0&&requestAnimationFrame(()=>ey(!1))}catch(e){console.error("Error loading data from localStorage",e),i([]),d({userProfile:{},conversationContext:{recentTopics:[],lastMentionedEntities:[],conversationTone:"friendly"},chatHistory:[]}),N(!1)}let e="default";if(t)try{e=localStorage.getItem(ei.aiFriendType)||"default"}catch(e){console.error("Error loading AI friend type from localStorage",e)}else try{localStorage.removeItem(G(void 0))}catch(e){console.error("Error clearing guest AI friend type",e)}A(e);let s=m.De.find(t=>t.value===e);I((null==s?void 0:s.imageUrl)||(0,m.N_)()),T((null==s?void 0:s.theme)||(0,m.E_)("default"))},[ei,n,L,t,ey]),(0,a.useEffect)(()=>{if(!n&&L&&o.length)try{localStorage.setItem(ei.chatHistory,JSON.stringify(o))}catch(e){console.error("Error saving chat history",e)}},[o,ei.chatHistory,n,L]),(0,a.useEffect)(()=>{if(!n&&L&&(c.userProfile.name||c.chatHistory.length>0||c.userProfile.interests&&c.userProfile.interests.length>0||c.userProfile.personalInfo&&Object.keys(c.userProfile.personalInfo).length>0))try{localStorage.setItem(ei.chatMemory,JSON.stringify(c))}catch(e){console.error("Error saving chat memory",e)}},[c,ei.chatMemory,n,L]);let ej=function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r={id:"".concat(Date.now(),"-").concat(Math.random().toString(36).substring(2,9)),text:e,sender:t,timestamp:Date.now(),feedback:null,...s};return i(e=>[...e,r]),r},ev=async e=>{try{em(!0);let t=await fetch("/api/speech",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:e})});if(!t.ok){let e=await t.json();throw Error(e.error||"Failed to generate speech")}let s=await t.blob(),r=URL.createObjectURL(s);ex(r),ef(!0);let a=()=>{em(!1),ef(!1),URL.revokeObjectURL(r)},l=new Audio(r);l.onended=a,l.onerror=e=>{console.error("Audio playback error:",e),a()};try{await l.play()}catch(e){console.error("Error playing audio:",e),a()}}catch(s){console.error("Speech generation error:",s),em(!1),ef(!1);let t=new SpeechSynthesisUtterance(e);t.onend=()=>em(!1),window.speechSynthesis.speak(t)}},ew=(0,a.useCallback)(async e=>{if(e.trim()){x(!0),ej(e,"user");try{let r=await M({message:e});if(r.isCrisis&&r.response){ej(r.response,"system",{isCrisis:!0}),x(!1);return}let a={message:Q(c,e)};t&&(null==s?void 0:s.gender)&&(a.userGender=s.gender),E&&"default"!==E&&(a.aiFriendType=E);let l=m.De.find(e=>e.value===(E||"default")),n=(null==l?void 0:l.imageUrl)||(0,m.N_)(),o=null==l?void 0:l.theme,i=await H(a),d=ej(i.response,"ai",{personaImage:n,aiBubbleColor:null==o?void 0:o.bubbleColor,aiTextColor:null==o?void 0:o.textColor});await ev(i.response),ep(e,i.response,d.id),t&&await ee({message_id:d.id,user_id:t.id,ai_response_text:i.response,user_prompt_text:e,feedback:d.feedback||"liked",ai_persona:E}),en()}catch(e){console.error("Error in handleSendMessage:",e),ej("Sorry, something went wrong. Please try again.","system")}finally{x(!1)}}},[t,s,E,c,ej,ep,ee,en]),eN=(0,a.useCallback)(async(e,s)=>{if(!t){k({title:"Login Required",description:"Please log in to give feedback.",variant:"destructive"});return}let r="",a="",l=s,n=E||"default";i(t=>t.map(t=>t.id===e&&"ai"===t.sender?(r=t.userPromptText||"",a=t.text,l=t.feedback===s?null:s,{...t,feedback:l}):t)),l&&r&&a&&await ee({message_id:e,user_id:t.id,ai_response_text:a,user_prompt_text:r,feedback:l,ai_persona:n})},[t,k,E]),ek=(null===(e=m.De.find(e=>e.value===E))||void 0===e?void 0:e.label)||"Talkzii",eC=t?20:10,eS=eo?"...":Math.max(0,eC-el);if(n||!L)return(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center h-full",children:[(0,r.jsx)(v,{personaImageUrl:z,personaName:ek})," ",(0,r.jsx)("p",{className:"ml-2 text-sm text-muted-foreground",children:"Loading chat state..."})]});let e_=(null==P?void 0:P.fontClassName)||"font-poppins",eE=c.userProfile.name||c.userProfile.interests&&c.userProfile.interests.length>0||c.userProfile.personalInfo&&Object.keys(c.userProfile.personalInfo).length>0||c.chatHistory&&c.chatHistory.length>0;return(0,r.jsxs)("div",{className:(0,l.cn)("flex flex-col h-full bg-background relative",e_),children:[y&&(0,r.jsx)("div",{className:"absolute top-4 right-4 z-30 bg-primary text-primary-foreground px-3 py-1.5 rounded-lg shadow-lg animate-in slide-in-from-right-5 fade-in-0 duration-300",children:(0,r.jsxs)("div",{className:"flex items-center gap-1.5 text-xs font-medium",children:[(0,r.jsx)(F.A,{className:"h-3.5 w-3.5"}),(0,r.jsx)("span",{children:"Remembered!"})]})}),eu&&(0,r.jsx)("div",{className:"fixed inset-0 z-50",children:(0,r.jsx)("iframe",{src:"/audiovisualizer",className:"w-full h-full border-none",onLoad:()=>{},onError:e=>{console.error("Error loading visualizer:",e),ef(!1)}})}),(0,r.jsxs)("div",{className:eu?"opacity-0 pointer-events-none":"opacity-100 transition-opacity duration-300",children:[(0,r.jsx)(D,{className:"flex-grow p-4 md:p-6",ref:C,children:(0,r.jsxs)("div",{className:"max-w-3xl mx-auto space-y-4 pb-4",children:[0===o.length&&!h&&(0,r.jsxs)("div",{className:"text-center text-muted-foreground py-10",children:[(0,r.jsx)(J.A,{className:"mx-auto h-12 w-12 mb-4 text-primary/70"}),(0,r.jsx)("p",{className:"text-lg font-semibold",children:"Start a conversation!"}),(0,r.jsxs)("p",{className:"text-sm",children:["Chatting with: ",(0,r.jsx)("span",{className:"font-semibold capitalize",style:{color:(null==P?void 0:P.accentColor)||"hsl(var(--primary))"},children:ek})]}),t&&(null==s?void 0:s.gender)&&(0,r.jsxs)("p",{className:"text-sm",children:["Gender for AI: ",(0,r.jsx)("span",{className:"font-semibold capitalize",style:{color:(null==P?void 0:P.accentColor)||"hsl(var(--primary))"},children:s.gender.replace(/_/g," ")})]}),(0,r.jsxs)("p",{className:"text-sm",children:["Messages remaining: ",(0,r.jsxs)("span",{className:"font-semibold",style:{color:(null==P?void 0:P.accentColor)||"hsl(var(--primary))"},children:[eS," / ",eC]})]}),eE&&(0,r.jsxs)("div",{className:"mt-4 p-3 bg-muted/50 rounded-lg border border-border text-xs max-w-sm mx-auto",children:[(0,r.jsxs)("div",{className:"flex items-center justify-center gap-2 mb-1.5",children:[(0,r.jsx)(F.A,{className:"h-4 w-4 text-primary"}),(0,r.jsx)("span",{className:"font-medium text-primary",children:"Memory Active"})]}),c.userProfile.name&&(0,r.jsxs)("p",{children:["Name: ",(0,r.jsx)("span",{className:"font-medium",children:c.userProfile.name})]}),c.userProfile.interests&&c.userProfile.interests.length>0&&(0,r.jsxs)("p",{children:["Interests: ",(0,r.jsxs)("span",{className:"font-medium",children:[c.userProfile.interests.slice(0,2).join(", "),c.userProfile.interests.length>2?"...":""]})]}),c.chatHistory.length>0&&(0,r.jsxs)("p",{children:["History: ",(0,r.jsxs)("span",{className:"font-medium",children:[c.chatHistory.length," exchanges"]})]})]}),(0,r.jsx)("p",{className:"text-sm mt-2",children:"Type your first message below."})]}),o.map(e=>(0,r.jsx)(u,{message:e,onFeedback:eN,onSpeak:()=>ev(e.text),isSpeaking:ed},e.id)),h&&(0,r.jsx)(v,{personaImageUrl:z,personaName:ek,personaTheme:P}),(0,r.jsx)("div",{ref:_})]})}),(0,r.jsx)("div",{className:"absolute top-2 left-2 sm:top-3 sm:left-3 flex gap-2 z-20",children:eE&&(0,r.jsxs)(f.$,{onClick:eg,variant:"outline",size:"icon",className:"bg-background/70 backdrop-blur-sm hover:bg-destructive hover:text-destructive-foreground transition-colors h-8 w-8 sm:h-9 sm:w-9 rounded-full shadow",title:"Clear chat memory (Ctrl+Shift+Del/Backspace)",children:[(0,r.jsx)(K.A,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"sr-only",children:"Clear Memory"})]})}),$&&(0,r.jsx)(f.$,{onClick:()=>ey(!0),variant:"outline",size:"icon",className:"fixed bottom-24 right-4 md:right-6 z-20 rounded-full w-10 h-10 p-0 shadow-lg bg-background/80 hover:bg-muted border-border backdrop-blur-sm transition-all duration-200 hover:scale-110","aria-label":"Scroll to bottom",children:(0,r.jsx)(V.A,{className:"h-5 w-5 text-foreground"})}),(0,r.jsx)("div",{className:"px-4 py-1 text-center text-xs text-muted-foreground border-t flex items-center justify-center gap-x-3 flex-wrap",children:(0,r.jsx)("span",{children:eo?"Loading...":"Messages remaining: ".concat(eS,"/").concat(eC,". ").concat(t?"Logged in":"Guest")})}),(0,r.jsx)(b,{onSendMessage:ew,isLoading:h,onMicStart:()=>ef(!0),onMicStop:()=>ef(!1),sendButtonAccentColor:null==P?void 0:P.accentColor,onFocus:()=>{window.innerWidth<768&&!et&&setTimeout(()=>ey(!0),300)},autoStartMicOnFocus:!0}),(0,r.jsx)(R,{isOpen:p,onClose:()=>g(!1),onSubscribe:()=>{k({title:"Subscribed! (Demo)",description:"Enjoy unlimited chats! (Chat count reset for demo)"}),g(!1)},accentColor:null==P?void 0:P.accentColor})]})]})}var es=s(8341),er=s(8186),ea=s(5458),el=s(286),en=s(3349),eo=s(7104),ei=s(6013),ec=s(7427),ed=s(6874),em=s.n(ed),eu=s(8309),ef=s(34),eh=s(3651),ex=s(2085),ep=s(5318);let eg=eh.bL,ey=eh.l9,eb=eh.bm,ej=eh.ZL,ev=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(eh.hJ,{className:(0,l.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...a,ref:t})});ev.displayName=eh.hJ.displayName;let ew=(0,ex.F)("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),eN=a.forwardRef((e,t)=>{let{side:s="right",className:a,children:n,...o}=e;return(0,r.jsxs)(ej,{children:[(0,r.jsx)(ev,{}),(0,r.jsxs)(eh.UC,{ref:t,className:(0,l.cn)(ew({side:s}),a),...o,children:[n,(0,r.jsxs)(eh.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[(0,r.jsx)(ep.A,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});eN.displayName=eh.UC.displayName;let ek=e=>{let{className:t,...s}=e;return(0,r.jsx)("div",{className:(0,l.cn)("flex flex-col space-y-2 text-center sm:text-left",t),...s})};ek.displayName="SheetHeader";let eC=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(eh.hE,{ref:t,className:(0,l.cn)("text-lg font-semibold text-foreground",s),...a})});eC.displayName=eh.hE.displayName,a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(eh.VY,{ref:t,className:(0,l.cn)("text-sm text-muted-foreground",s),...a})}).displayName=eh.VY.displayName;var eS=s(7489);let e_=a.forwardRef((e,t)=>{let{className:s,orientation:a="horizontal",decorative:n=!0,...o}=e;return(0,r.jsx)(eS.b,{ref:t,decorative:n,orientation:a,className:(0,l.cn)("shrink-0 bg-border","horizontal"===a?"h-[1px] w-full":"h-full w-[1px]",s),...o})});function eE(){let{user:e,signOut:t,isLoading:s}=(0,Z.A)(),[l,n]=(0,a.useState)(!1),o=(0,y.useRouter)();return((0,a.useEffect)(()=>{n(!0)},[]),s||!l)?(0,r.jsx)(ec.k,{message:"Preparing chat..."}):(0,r.jsxs)("div",{className:"flex flex-col min-h-dvh bg-background",children:[(0,r.jsx)("header",{className:"sticky top-0 z-20 w-full border-b border-border/40 bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60",children:(0,r.jsxs)("div",{className:"container flex h-16 max-w-5xl mx-auto items-center justify-between px-4",children:[(0,r.jsx)("div",{className:"flex items-center w-12",children:(0,r.jsxs)(eg,{children:[(0,r.jsx)(ey,{asChild:!0,children:(0,r.jsxs)(f.$,{variant:"ghost",size:"icon",title:"Menu",className:"text-foreground",children:[(0,r.jsx)(es.A,{className:"h-6 w-6"}),(0,r.jsx)("span",{className:"sr-only",children:"Open Menu"})]})}),(0,r.jsxs)(eN,{side:"left",className:"w-[280px] sm:w-[320px] p-0 pt-6 flex flex-col",children:[(0,r.jsx)(ek,{className:"px-6 pb-4",children:(0,r.jsx)(eC,{className:"text-left",children:(0,r.jsx)(eu.g,{width:100,height:34})})}),(0,r.jsx)(e_,{}),(0,r.jsxs)("nav",{className:"flex-grow p-4 space-y-2",children:[(0,r.jsx)(eb,{asChild:!0,children:(0,r.jsx)(em(),{href:"/",passHref:!0,children:(0,r.jsxs)(f.$,{variant:"ghost",className:"w-full justify-start text-base py-3",children:[(0,r.jsx)(er.A,{className:"mr-3 h-5 w-5"}),"Home"]})})}),(0,r.jsx)(eb,{asChild:!0,children:(0,r.jsx)(em(),{href:"/aipersona",passHref:!0,children:(0,r.jsxs)(f.$,{variant:"ghost",className:"w-full justify-start text-base py-3",children:[(0,r.jsx)(ea.A,{className:"mr-3 h-5 w-5"}),"Change AI Persona"]})})}),(0,r.jsx)(eb,{asChild:!0,children:(0,r.jsx)(em(),{href:"/explore",passHref:!0,children:(0,r.jsxs)(f.$,{variant:"ghost",className:"w-full justify-start text-base py-3",children:[(0,r.jsx)(el.A,{className:"mr-3 h-5 w-5"}),"Explore Personas"]})})})]}),(0,r.jsx)(e_,{}),(0,r.jsx)("div",{className:"p-4 mt-auto",children:e?(0,r.jsx)(eb,{asChild:!0,children:(0,r.jsxs)(f.$,{variant:"outline",onClick:t,className:"w-full text-base py-3",children:[(0,r.jsx)(en.A,{className:"mr-3 h-5 w-5"}),"Logout"]})}):(0,r.jsx)(eb,{asChild:!0,children:(0,r.jsx)(em(),{href:"/auth",passHref:!0,children:(0,r.jsxs)(f.$,{variant:"default",className:"w-full text-base py-3 gradient-button",children:[(0,r.jsx)(eo.A,{className:"mr-3 h-5 w-5"}),"Login / Sign Up"]})})})}),(0,r.jsxs)("div",{className:"px-6 py-3 text-center text-xs text-muted-foreground",children:["\xa9 ",new Date().getFullYear()," Talkzii"]})]})]})}),(0,r.jsx)("div",{className:"flex-1 text-center",children:(0,r.jsx)(em(),{href:"/",passHref:!0,"aria-label":"Talkzii Home",children:(0,r.jsx)(eu.g,{width:90,height:30})})}),(0,r.jsxs)("div",{className:"flex items-center space-x-1 sm:space-x-2 w-auto justify-end",children:[e&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(f.$,{variant:"ghost",size:"icon",asChild:!0,title:"Change AI Persona",className:"text-foreground",children:(0,r.jsxs)(em(),{href:"/aipersona",children:[(0,r.jsx)(ei.A,{className:"h-5 w-5"}),(0,r.jsx)("span",{className:"sr-only",children:"Change AI Persona"})]})}),(0,r.jsxs)(f.$,{variant:"ghost",size:"icon",onClick:t,title:"Logout",className:"text-foreground",children:[(0,r.jsx)(en.A,{className:"h-5 w-5"}),(0,r.jsx)("span",{className:"sr-only",children:"Logout"})]})]}),!e&&(0,r.jsxs)(f.$,{variant:"outline",onClick:()=>o.push("/auth"),title:"Login / Sign Up",children:[(0,r.jsx)(eo.A,{className:"h-5 w-5 mr-2 sm:mr-0"}),(0,r.jsx)("span",{className:"hidden sm:inline ml-1",children:"Login / Sign Up"})]})]})]})}),(0,r.jsx)(ef.z,{}),(0,r.jsx)("main",{className:"flex-grow overflow-hidden",children:(0,r.jsx)(et,{})})]})}e_.displayName=eS.b.displayName}},e=>{var t=t=>e(e.s=t);e.O(0,[4277,6874,6629,7378,4908,8888,9138,8441,1684,7358],()=>t(8198)),_N_E=e.O()}]);